//state machine stuff
enum State_enum {ON, OFF, RUN, SLEEP, DIAGNOSTIC};
// enum Sensors_enum {NONE, SENSOR_RIGHT, SENSOR_LEFT, BOTH};

void on();
void off();
void run1();
void sleep();
void diagnostic();
uint8_t read_IR();
uint8_t state = OFF;
bool switch_1_pressed();
bool switch_2_pressed();
bool switch_3_pressed();
bool switch1;
bool switch2;
bool switch3;
void state_machine_run(bool switch1,bool switch2,bool switch3);

//not state machine stuff
int RED_PIN = 13;
int GREEN_PIN = 10;
int BLUE_PIN = 9;
int SWITCH1 = 7;
int SWITCH2 = 6;
int SWITCH3 = 5;


int fadeAmount = 5;    // how many points to fade the LED by

void setup() {
  pinMode(RED_PIN, OUTPUT);
  pinMode(GREEN_PIN, OUTPUT);
  pinMode(SWITCH1, INPUT);

}

void loop() {

   switch1 = switch_1_pressed();
   switch2 = switch_2_pressed();
   switch3 = switch_3_pressed();

  
   state_machine_run(switch1, switch2, switch3);
 
}



void state_machine_run(bool switch1,bool switch2,bool switch3)
{
 switch(state)
 {
   case ON:
       if(!switch1 && !switch2 && switch3){
         off();
         state = OFF;
       }
       else if(!switch1 && switch2 && !switch3){
         run1();
         state = RUN;
       }
       else if(switch1 && !switch2 && !switch3){
         sleep();
         state = SLEEP;
       }
       else if(!switch1 && switch2 && switch3){
         diagnostic();
         state = DIAGNOSTIC;
       }
       break;
    case OFF:
         if(!switch1 && !switch2 && !switch3){
           on();
           state = ON;
         }
         break;
     case RUN:
         if(!switch1 && !switch2 && !switch3){
           on();
           state = ON;
         }
     break;
     case SLEEP:
         if(!switch1 && !switch2 && !switch3){
           on();
           state = ON;
         }
     break;
     case DIAGNOSTIC:
         if(!switch1 && !switch2 && switch3){
           on();
           state = ON;
         }
     break;
 
 }
}



void on()
{
    //red led
  
    digitalWrite(RED_PIN, HIGH);   // turn the LED on (HIGH is the voltage level)
    delay(100);                       // wait for a second
    digitalWrite(RED_PIN, LOW);    // turn the LED off by making the voltage LOW
    delay(100);
}

void off()
{
  //led off logic
}


//green led
void run1()
{
    unsigned long button_time = 0;
    unsigned long last_button_time = 0;
    button_time = millis();

    int brightness = analogRead(A1) / 4;
    
  
    if(analogRead(A0) > 500){
        for(int i = 0; i < 40; i++){
          analogWrite(GREEN_PIN, brightness);   // turn the LED on (HIGH is the voltage level)
          delay(50);                       // wait for a second
          analogWrite(GREEN_PIN, 0);    // turn the LED off by making the voltage LOW
          delay(50);
        }
    }
    else{
        fade_led(6, GREEN_PIN);
   
        for(int i = 0; i < 2; i++){
          analogWrite(GREEN_PIN, brightness);   // turn the LED on (HIGH is the voltage level)
          delay(100);                       // wait for a second
          analogWrite(GREEN_PIN, brightness);    // turn the LED off by making the voltage LOW
          delay(100);
        }   
       
      last_button_time = button_time;  
       
    }
}

void sleep()
{
     //led sleep logic
    flash_led(3, BLUE_PIN);


    //FADE CODE
    fade_led(6, BLUE_PIN);
}

void flash_led(int flashes, int LED)
{
    int delaytime = 1000/flashes;
    for (int i = 0; i<flashes;i++)
    {
      digitalWrite(LED, HIGH);   // turn the LED on (HIGH is the voltage level)
      delay(delaytime);                       // wait for a second
      digitalWrite(LED, LOW);    // turn the LED off by making the voltage LOW
      delay(delaytime);
    }
}

void fade_led(int fade_time, int LED)
{
      int brightness = 255;
      while(brightness >= 0 ){
       analogWrite(LED, brightness); 
       brightness = brightness - 5;     
       delay(fade_time * 20);
     }
}


//led diagnostic logic
void diagnostic()
{
      int problems = 4;
      flash_led(problems, RED_PIN);
}

uint8_t read_IR()
{
    //gets sensor/ user input
}

bool switch_1_pressed()
{
  return digitalRead(SWITCH1);
}
bool switch_2_pressed()
{
  return digitalRead(SWITCH2);
}
bool switch_3_pressed()
{
  return digitalRead(SWITCH3);
}
